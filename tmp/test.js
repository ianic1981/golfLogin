"use strict";
const Nightmare = require("nightmare");
const moment = require("moment");
const nightmare = new Nightmare({ show: false });
var argv = require('minimist')(process.argv.slice(2));
console.log(argv);
var user = argv.user;
var pwd = process.env.pwd2 || argv.pwd;
console.log(pwd);
let myMoment = moment();
myMoment.add(21, 'days');
console.log(myMoment.date());
console.log(myMoment.format("MMM"));
const dayOption = myMoment.date();
const monthOption = myMoment.format("MMM");
nightmare
    .goto('https://www.brsgolf.com/wychwoodpark/member/login')
    .type('[name="_username"]', user)
    .type('[name="_password"]', pwd)
    .click('input[name="SUBMIT"]')
    .wait('.book_a_tee_time_button')
    .click('.book_a_tee_time_button')
    .evaluate(selectMonth, monthOption)
    .evaluate(selectDay, dayOption)
    .wait(".table_white_text")
    .evaluate(() => { return document.querySelector(".day_page_date").innerText; })
    .then(console.log)
    .then(() => {
    return nightmare.evaluate(() => {
        var error = "";
        let inputs = document.querySelector(".table_white_text tbody").querySelectorAll("tr");
        for (var i = 0, length = inputs.length; i < length; i++) {
            var data = inputs[i].innerText.replace('18s', '').replace("Reserved For Members", "").trim();
            if (data.indexOf('08:') >= 0) {
                if (data.length == 5) {
                    var val = inputs[i].querySelectorAll("input[name=\"SubmitButton\"]");
                    val[0].click();
                    return data;
                }
                else {
                    error += " " + data;
                }
            }
        }
        throw new Error("no time: " + error);
    }).then(console.log);
})
    .then(() => {
    return nightmare
        .wait('.back_button_cell a')
        .wait(1000)
        .select("[name='Player1_uid']", "449")
        .select("[name='Player2_uid']", "Member")
        .select("[name='Player3_uid']", "Member")
        .select("[name='Player4_uid']", "Member")
        .wait(3000)
        .click('[name=\'SubmitButton\']')
        .wait(1000)
        .end(() => "finished");
})
    .then(console.log)
    .catch((error) => {
    console.error('Search failed:', error);
});
console.log("start");
function selectMonth(month) {
    console.log(month);
    // var test = document.querySelector(".month_navigation .t_b");
    // var test2 = test.getElementsByTagName("a");
    // test2.item(month).click()
    let length = 0;
    while (length < document.querySelectorAll(".month_navigation .date_large").length) {
        if (document.querySelectorAll(".month_navigation .date_large").item(length).innerText.indexOf(month) > -1) {
            document.querySelectorAll(".month_navigation .date_large").item(length).click();
            length = 13;
        }
        length++;
    }
}
function selectDay(dayOption) {
    console.log(dayOption);
    let length = 1;
    while (length < document.querySelector(".tableList tbody").getElementsByTagName("tr").length) {
        if (document.querySelector(".tableList tbody").getElementsByTagName("tr").item(length).innerText.indexOf(dayOption) > -1) {
            let day = document.querySelector(".tableList tbody").getElementsByTagName("tr")[length];
            day.getElementsByClassName("day_num").item(0).getElementsByTagName("a").item(0).click();
            length = 999;
        }
        length++;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3Rlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHVDQUF1QztBQUN2QyxpQ0FBaUM7QUFFakMsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztBQUUvQyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN0RCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBR2pCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7QUFDckIsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQztBQUV2QyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBRWhCLElBQUksUUFBUSxHQUFrQixNQUFNLEVBQUUsQ0FBQztBQUd2QyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQTtBQUV4QixPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO0FBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0FBRW5DLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsQyxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBRTNDLFNBQVM7S0FDSixJQUFJLENBQUMsbURBQW1ELENBQUM7S0FDekQsSUFBSSxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQztLQUNoQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsR0FB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